{% extends 'base.html' %} 

{% block javascript %}
  <script>
    $(".btn-update").click(function () {
        $.ajax({
            type: 'post',
            url: '{% url "update_package" %}',
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                system_id: '{{ system_id }}',
                package_id: this.id.substr(this.id.indexOf('-') + 1),
                ssh_passphase: $('#id_ssh_passphase').val()
            },
            dataType: 'json',
            success: function (data) {
                if (data.error) {
                    toastr.error(data.message);
                }
                else {
                    toastr.success(data.message);
                }
            }
        });
    });
  </script>
{% endblock %}

{% block content %}
{% include "includes/inline_form.html" %}

<table class="table">
    <thead class="thead-inverse">
        <tr>
            <th>Package name</th>
            <th>Current Version</th>
            <th>New Version</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for package in outdated_packages %}
        <tr>
            <td>{{ package.name }}</td>
            <td>{{ package.current_version }}</td>
            <td>{{ package.new_version }}</td>
            <td><button id='package-{{ package.id }}' type="button" class="btn btn-primary btn-update">Update</button></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<br><br>

<table class="table">
    <thead class="thead-inverse">
        <tr>
            <th>Package name</th>
            <th>Current Version</th>
        </tr>
    </thead>
    <tbody>
        {% for package in installed_packages %}
        <tr>
            <td>{{ package.name }}</td>
            <td>{{ package.current_version }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock content %}